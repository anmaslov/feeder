# üêæ –ê–≤—Ç–æ–∫–æ—Ä–º—É—à–∫–∞ –¥–ª—è –ø–∏—Ç–æ–º—Ü–µ–≤ –Ω–∞ ESP32-CAM

–£–º–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä–º—É—à–∫–∞ –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ –±–∞–∑–µ ESP32-CAM —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º, MQTT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å Home Assistant Auto Discovery –∏ OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

![ESP32-CAM](https://img.shields.io/badge/ESP32-CAM-blue)
![PlatformIO](https://img.shields.io/badge/PlatformIO-Compatible-orange)
![License](https://img.shields.io/badge/license-MIT-green)
![MQTT](https://img.shields.io/badge/MQTT-Home_Assistant-green)
![Version](https://img.shields.io/badge/version-3.2.0-blue)

üá¨üáß [English version](README.md)

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π**: –∫–æ—Ä–æ—Ç–∫–∏–π –∫–ª–∏–∫ –¥–ª—è –∫–æ—Ä–º–ª–µ–Ω–∏—è, —É–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- ‚úÖ **RGB LED –∏–Ω–¥–∏–∫–∞—Ü–∏—è**: WS2812B –ª–µ–Ω—Ç–∞ (2 LED) —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫**: –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —ç–Ω–µ—Ä–≥–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –ø–∞–º—è—Ç–∏ (Preferences)
- ‚úÖ **WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥–æ–º–∞—à–Ω–µ–π —Å–µ—Ç–∏
- ‚úÖ **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –¥–æ 5 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ—Ä–º–ª–µ–Ω–∏–π –≤ –¥–µ–Ω—å
- ‚úÖ **NTP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ **OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏ –ø–æ –≤–æ–∑–¥—É—Ö—É
- ‚úÖ **MQTT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Home Assistant Auto Discovery

### MQTT –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- üì° **Auto Discovery**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ Home Assistant
- üìä **–°–µ–Ω—Å–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏**: timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- üéÆ **–£–¥–∞–ª–µ–Ω–Ω–æ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ**: –∫–æ–º–∞–Ω–¥–∞ –∫–æ—Ä–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ MQTT –∫–Ω–æ–ø–∫—É
- üì± **Home Assistant**: –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ–Ω—Å–æ—Ä–∞–º–∏ –∏ –∫–Ω–æ–ø–∫–∞–º–∏
- üîî **–°–µ–Ω—Å–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ—Ä–º–ª–µ–Ω–∏—è**: JSON —Å –≤—Ä–µ–º–µ–Ω–µ–º, –ø–æ—Ä—Ü–∏–µ–π –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º
- ‚úÖ **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: binary sensor online/offline —Å Last Will

## üõ† –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| ESP32-CAM | –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç–∞ |
| –®–∞–≥–æ–≤—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å 28BYJ-48 | –î–≤–∏–≥–∞—Ç–µ–ª—å –¥–ª—è —à–Ω–µ–∫–∞ |
| –î—Ä–∞–π–≤–µ—Ä ULN2003 | –î—Ä–∞–π–≤–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º |
| WS2812B LED –ª–µ–Ω—Ç–∞ | 2 –∞–¥—Ä–µ—Å–Ω—ã—Ö —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞ |
| –ö–Ω–æ–ø–∫–∞ | –¢–∞–∫—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 5V/2A | –ü–∏—Ç–∞–Ω–∏–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã |

## üìå –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### ESP32-CAM ‚Üí –î—Ä–∞–π–≤–µ—Ä –º–æ—Ç–æ—Ä–∞ (ULN2003)
```
GPIO 12 (IN1) ‚Üí –§–∞–∑–∞ 1
GPIO 13 (IN2) ‚Üí –§–∞–∑–∞ 2
GPIO 15 (IN3) ‚Üí –§–∞–∑–∞ 3
GPIO 14 (IN4) ‚Üí –§–∞–∑–∞ 4
```

### –ö–Ω–æ–ø–∫–∞
```
GPIO 2 ‚Üí –û–¥–∏–Ω –∫–æ–Ω—Ç–∞–∫—Ç –∫–Ω–æ–ø–∫–∏
GND    ‚Üí –î—Ä—É–≥–æ–π –∫–æ–Ω—Ç–∞–∫—Ç –∫–Ω–æ–ø–∫–∏
```

### LED –ª–µ–Ω—Ç–∞ WS2812B
```
GPIO 16 ‚Üí DIN (Data In)
5V      ‚Üí VCC
GND     ‚Üí GND
```

### –ü–∏—Ç–∞–Ω–∏–µ
```
5V  ‚Üí VCC (–Ω–∞ –¥—Ä–∞–π–≤–µ—Ä–µ –∏ ESP32-CAM)
GND ‚Üí GND (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone https://github.com/anmaslov/feeder.git
cd feeder
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```bash
# WiFi
WIFI_SSID=your_wifi_ssid
WIFI_PASSWORD=your_wifi_password

# MQTT
MQTT_SERVER=192.168.1.100
MQTT_PORT=1883
MQTT_USER=mqtt_user
MQTT_PASSWORD=mqtt_password

# OTA
ESP_IP=192.168.1.100
OTA_HOSTNAME=ESP32-Feeder
```

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ USB
```bash
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ OTA –∑–∞–≥—Ä—É–∑–∫—É –≤ platformio.ini –¥–ª—è USB –∑–∞–≥—Ä—É–∑–∫–∏
platformio run --target upload
```

### 4. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
```bash
platformio run --target uploadfs
```

### 5. OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
```bash
platformio run --target upload --upload-port ESP_IP_FROM_ENV
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è

| –ò–Ω–¥–∏–∫–∞—Ü–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| 3 —Å–∏–Ω–µ-–∫—Ä–∞—Å–Ω—ã—Ö –º–∏–≥–∞–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ | –ü–ª–∞—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ |
| –ñ—ë–ª—Ç–æ–µ –º–∏–≥–∞–Ω–∏–µ | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi |
| –ó–µ–ª—ë–Ω—ã–µ LED (1 —Å–µ–∫) | WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω |
| –ö—Ä–∞—Å–Ω—ã–µ LED (2 —Å–µ–∫) | –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WiFi |
| –†–∞–¥—É–∂–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è | –ò–¥—ë—Ç –∫–æ—Ä–º–ª–µ–Ω–∏–µ |
| –§–∏–æ–ª–µ—Ç–æ–≤—ã–µ LED | –ò–¥—ë—Ç OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| –ö–æ—Ä–æ—Ç–∫–∞—è –∑–µ–ª—ë–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ (–∫–∞–∂–¥—ã–µ 30—Å) | –°–∏—Å—Ç–µ–º–∞ –≤ –Ω–æ—Ä–º–µ |
| –ö–æ—Ä–æ—Ç–∫–∞—è —Å–∏–Ω—è—è –≤—Å–ø—ã—à–∫–∞ (–∫–∞–∂–¥—ã–µ 10—Å) | –ü—Ä–æ–±–ª–µ–º—ã —Å WiFi |
| –ö–æ—Ä–æ—Ç–∫–∞—è –∫—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ (–∫–∞–∂–¥—ã–µ 3—Å) | –û—à–∏–±–∫–∞ |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π

#### –ö–æ—Ä–æ—Ç–∫–∏–π –∫–ª–∏–∫ (< 0.5 —Å–µ–∫)
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∫–æ—Ä–º–ª–µ–Ω–∏—è
- –ú–æ—Ç–æ—Ä –≤—ã–¥–∞—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –ø–æ—Ä—Ü–∏—é –∫–æ—Ä–º–∞
- –†–∞–¥—É–∂–Ω–∞—è LED –∞–Ω–∏–º–∞—Ü–∏—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

#### –£–¥–µ—Ä–∂–∞–Ω–∏–µ (> 0.5 —Å–µ–∫)
- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø–æ—Ä—Ü–∏–∏
- –ó–µ–ª—ë–Ω—ã–µ LED –∑–∞–≥–æ—Ä–∞—é—Ç—Å—è
- –ú–æ—Ç–æ—Ä –∫—Ä—É—Ç–∏—Ç—Å—è –ø–æ–∫–∞ –¥–µ—Ä–∂–∏—Ç–µ –∫–Ω–æ–ø–∫—É
- –û—Ç–ø—É—Å—Ç–∏—Ç–µ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–º–∞ –≤—ã–¥–∞–Ω–æ
- –ù–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ—Ä—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–í —Ñ–∞–π–ª–µ `include/config.h` –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:

```cpp
#define FEED_SPEED 3000         // –°–∫–æ—Ä–æ—Å—Ç—å –º–æ—Ç–æ—Ä–∞ (–º–∫—Å –º–µ–∂–¥—É —à–∞–≥–∞–º–∏)
#define STEPS_FRW 19            // –®–∞–≥–∏ –≤–ø–µ—Ä—ë–¥
#define STEPS_BKW 12            // –®–∞–≥–∏ –Ω–∞–∑–∞–¥ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ)
#define DEFAULT_FEED_AMOUNT 15  // –ü–æ—Ä—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–æ–±–æ—Ä–æ—Ç–æ–≤)
#define MAX_SCHEDULES 5         // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
#define LED_BRIGHTNESS 50       // –Ø—Ä–∫–æ—Å—Ç—å LED (0-255)
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
feeder/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥, setup –∏ loop
‚îÇ   ‚îú‚îÄ‚îÄ feeder.cpp         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–æ–º, LED —ç—Ñ—Ñ–µ–∫—Ç—ã, –∫–æ—Ä–º–ª–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ schedule.cpp       # –õ–æ–≥–∏–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ mqtt_handler.cpp   # MQTT –∫–ª–∏–µ–Ω—Ç —Å Auto Discovery
‚îÇ   ‚îú‚îÄ‚îÄ web_server.cpp     # HTTP API –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îî‚îÄ‚îÄ SimpleButton.h     # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îú‚îÄ‚îÄ config.h           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–∏–Ω—ã, —Ç–∞–π–º–µ—Ä—ã, MQTT —Ç–æ–ø–∏–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ feeder.h           # –ó–∞–≥–æ–ª–æ–≤–æ–∫ feeder
‚îÇ   ‚îú‚îÄ‚îÄ schedule.h         # –ó–∞–≥–æ–ª–æ–≤–æ–∫ schedule
‚îÇ   ‚îú‚îÄ‚îÄ mqtt_handler.h     # –ó–∞–≥–æ–ª–æ–≤–æ–∫ MQTT
‚îÇ   ‚îî‚îÄ‚îÄ web_server.h       # –ó–∞–≥–æ–ª–æ–≤–æ–∫ web server
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ config.json        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –ø–æ—Ä—Ü–∏–∏)
‚îÇ   ‚îî‚îÄ‚îÄ index.html         # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ load_env.py            # –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ .env –¥–ª—è PlatformIO
‚îú‚îÄ‚îÄ platformio.ini         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PlatformIO
‚îú‚îÄ‚îÄ LOVELACE_CARD.yaml     # –ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è Home Assistant
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ README.md              # –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README_RU.md           # –†—É—Å—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ –∞–¥—Ä–µ—Å—É `http://<ESP_IP>/` –¥–ª—è:
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (NTP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- –†—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ—Ä–º–ª–µ–Ω–∏—è —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –ø–æ—Ä—Ü–∏–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ 5 –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ—Ä–º–ª–µ–Ω–∏–π
- –í–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π

### API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/` | GET | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| `/api/time` | GET | –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è |
| `/api/schedules` | GET | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è |
| `/api/schedules` | POST | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è |
| `/api/feed?amount=N` | GET | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ—Ä–º–ª–µ–Ω–∏–µ |
| `/api/toggle?id=N` | GET | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–∫–ª/–≤—ã–∫–ª |
| `/api/setbase?amount=N` | GET | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑–æ–≤—É—é –ø–æ—Ä—Ü–∏—é |

## üåê OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ß–µ—Ä–µ–∑ PlatformIO
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `platformio.ini`:
```ini
upload_protocol = espota
; upload_port —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ .env —á–µ—Ä–µ–∑ load_env.py
```

### –ß–µ—Ä–µ–∑ Arduino IDE
1. –ú–µ–Ω—é: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ü–æ—Ä—Ç
2. –í—ã–±–µ—Ä–∏—Ç–µ `ESP32-Feeder at 192.168.x.x`
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫–µ—Ç—á

## üîç –û—Ç–ª–∞–¥–∫–∞

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Serial Monitor (115200 baud) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤:
```
===========================================
  ESP32-CAM –ê–≤—Ç–æ–∫–æ—Ä–º—É—à–∫–∞ v3.2
===========================================

[OK] LED –ª–µ–Ω—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
[OK] –ü–∏–Ω—ã –¥—Ä–∞–π–≤–µ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
[OK] –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
[OK] WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω!
     IP: 192.168.x.x
[OK] –í—Ä–µ–º—è: 16.12.2025 14:30:00
[OK] OTA –≥–æ—Ç–æ–≤
[MQTT] –ù–∞—Å—Ç—Ä–æ–µ–Ω
[MQTT] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... OK!
[DISCOVERY] –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...
[DISCOVERY] –ì–æ—Ç–æ–≤–æ!
[OK] Web-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 80

===========================================
  –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê!
  http://192.168.x.x
===========================================
```

## üì° MQTT –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Auto Discovery

–ö–æ—Ä–º—É—à–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ Home Assistant —á–µ—Ä–µ–∑ MQTT Auto Discovery. –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

### MQTT –¢–æ–ø–∏–∫–∏

| –¢–æ–ø–∏–∫ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| `homeassistant/binary_sensor/feeder/availability/state` | –ü—É–±–ª–∏–∫–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å online/offline |
| `homeassistant/sensor/feeder/boot_time/state` | –ü—É–±–ª–∏–∫–∞—Ü–∏—è | ISO timestamp –∑–∞–≥—Ä—É–∑–∫–∏ |
| `homeassistant/sensor/feeder/last_feeding/state` | –ü—É–±–ª–∏–∫–∞—Ü–∏—è | JSON –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ—Ä–º–ª–µ–Ω–∏—è |
| `homeassistant/button/feeder/feed/set` | –ü–æ–¥–ø–∏—Å–∫–∞ | –ö–æ–º–∞–Ω–¥–∞ –∫–æ—Ä–º–ª–µ–Ω–∏—è |

### –§–æ—Ä–º–∞—Ç JSON –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ—Ä–º–ª–µ–Ω–∏—è
```json
{
  "timestamp": "2025-12-16T14:30:00+03:00",
  "amount": 15,
  "source": "button"  // –∏–ª–∏ "mqtt", "web", "schedule"
}
```

### –°—É—â–Ω–æ—Å—Ç–∏ –≤ Home Assistant

| –°—É—â–Ω–æ—Å—Ç—å | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `binary_sensor.kormushka_dlia_kota_kormushka_onlain` | Binary Sensor | –°—Ç–∞—Ç—É—Å online/offline |
| `sensor.kormushka_dlia_kota_vremia_zagruzki` | Sensor | –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ |
| `sensor.kormushka_dlia_kota_poslednee_kormlenie` | Sensor | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ |
| `button.kormushka_dlia_kota_pokormit_kota` | Button | –ö–æ–º–∞–Ω–¥–∞ –∫–æ—Ä–º–ª–µ–Ω–∏—è |

### –†—É—á–Ω—ã–µ MQTT –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–∫–æ—Ä–º–∏—Ç—å —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ—Ä—Ü–∏–µ–π
mosquitto_pub -h YOUR_MQTT_SERVER -u YOUR_USER -P YOUR_PASSWORD \
  -t "homeassistant/button/feeder/feed/set" -m "20"

# –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ
mosquitto_sub -h YOUR_MQTT_SERVER -u YOUR_USER -P YOUR_PASSWORD \
  -t "homeassistant/sensor/feeder/last_feeding/state"
```

## üè† Home Assistant Lovelace –∫–∞—Ä—Ç–æ—á–∫–∞

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ `LOVELACE_CARD.yaml`:

```yaml
type: vertical-stack
cards:
  - type: glance
    title: üê± –ö–æ—Ä–º—É—à–∫–∞ –¥–ª—è –∫–æ—Ç–∞
    entities:
      - entity: binary_sensor.kormushka_dlia_kota_kormushka_onlain
        name: –°—Ç–∞—Ç—É—Å
      - entity: sensor.kormushka_dlia_kota_vremia_zagruzki
        name: –ó–∞–≥—Ä—É–∑–∫–∞
        format: relative
  - type: entities
    entities:
      - entity: sensor.kormushka_dlia_kota_poslednee_kormlenie
        name: –ö–æ—Ä–º–ª–µ–Ω–∏–µ
        format: relative
      - type: attribute
        entity: sensor.kormushka_dlia_kota_poslednee_kormlenie
        attribute: amount
        name: –ü–æ—Ä—Ü–∏—è
        suffix: " –æ–±–æ—Ä–æ—Ç–æ–≤"
  - type: horizontal-stack
    cards:
      - type: button
        entity: button.kormushka_dlia_kota_pokormit_kota
        name: –ü–æ–∫–æ—Ä–º–∏—Ç—å (10)
        tap_action:
          action: call-service
          service: mqtt.publish
          data:
            topic: homeassistant/button/feeder/feed/set
            payload: "10"
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ú–æ—Ç–æ—Ä –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è –∏–ª–∏ –≥—É–¥–∏—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–∑
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ –ø—Ä–æ–≤–æ–¥–∞ –Ω–∞ –¥—Ä–∞–π–≤–µ—Ä–µ
- –£–≤–µ–ª–∏—á—å—Ç–µ `FEED_SPEED` (–∑–∞–º–µ–¥–ª–∏—Ç—å –º–æ—Ç–æ—Ä)

### WiFi –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SSID –∏ –ø–∞—Ä–æ–ª—è
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ä–æ—É—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 2.4 GHz (ESP32 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 5GHz)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–ª—É —Å–∏–≥–Ω–∞–ª–∞ WiFi

### LED –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GPIO 16
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –ø–∏—Ç–∞–Ω–∏—è 5V –Ω–∞ LED –ª–µ–Ω—Ç–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É `NUM_LEDS` –≤ config.h

### OTA –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ ESP32 –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç 3232 –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Ñ–∞–µ—Ä–≤–æ–ª–æ–º
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å –≤–º–µ—Å—Ç–æ hostname

### MQTT –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±—Ä–æ–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: `systemctl status mosquitto`
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ IP –∞–¥—Ä–µ—Å–∞ –∏ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–º–æ—Ç—Ä–∏—Ç–µ Serial Monitor –¥–ª—è –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ MQTT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Ç–æ–ø–∏–∫–∏ homeassistant/#

### Home Assistant –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ MQTT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- –ò—â–∏—Ç–µ —Å—É—â–Ω–æ—Å—Ç–∏ —Å "kormushka" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ MQTT –±—Ä–æ–∫–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ discovery —Å–æ–æ–±—â–µ–Ω–∏–π

## üìö –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–µ

–ü—Ä–æ–µ–∫—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ [GyverFeed2](https://github.com/AlexGyver/GyverFeed2) –æ—Ç [AlexGyver](https://alexgyver.ru/gyverfeed2/)

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç—Å—è! –ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ—Ç–∫—Ä—ã–≤–∞—Ç—å issues –∏–ª–∏ pull requests.

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

**‚≠ê –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É –Ω–∞ GitHub!**
