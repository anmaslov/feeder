<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>–ö–æ—Ä–º—É—à–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 95%;
            width: 500px;
            margin: 20px auto;
            padding: 10px;
            background: #f0f0f0;
        }
        .card {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #4CAF50;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #45a049;
        }
        input[type='number'], input[type='time'] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        h3 {
            margin-top: 0;
            color: #555;
        }
        .schedule-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .schedule-item:last-child {
            border-bottom: none;
        }
        label {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>üê± –ö–æ—Ä–º—É—à–∫–∞</h1>
    
    <!-- –í—Ä–µ–º—è -->
    <div class='card'>
        <h3>‚è∞ –í—Ä–µ–º—è: <span id='time'>–∑–∞–≥—Ä—É–∑–∫–∞...</span></h3>
    </div>
    
    <!-- –†—É—á–Ω–æ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ -->
    <div class='card'>
        <h3>üçΩÔ∏è –ö–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
        <div>
            –ü–æ—Ä—Ü–∏—è: <input type='number' id='amt' value='15' min='1' max='500'>
            <button class='btn' onclick='feed()'>–ü–æ–∫–æ—Ä–º–∏—Ç—å —Å–µ–π—á–∞—Å</button>
        </div>
    </div>
    
    <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
    <div class='card'>
        <h3>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ—Ä–º–ª–µ–Ω–∏—è</h3>
        <div id='sch'>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button class='btn' onclick='save()'>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
    </div>

    <script>
        // –†—É—á–Ω–æ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ
        function feed() {
            const amount = document.getElementById('amt').value;
            fetch('/api/feed?amount=' + amount)
                .then(() => alert('‚úÖ –ö–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ!'))
                .catch(() => alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è'));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        function load() {
            fetch('/api/schedules')
                .then(r => r.json())
                .then(d => {
                    let html = '';
                    for (let i = 0; i < 5; i++) {
                        let s = d.schedules[i];
                        let timeVal = String(s.hour).padStart(2, '0') + ':' + String(s.minute).padStart(2, '0');
                        html += `<div class='schedule-item'>`;
                        html += `<strong>#${i + 1}:</strong> `;
                        html += `<input type='time' id='t${i}' value='${timeVal}'> `;
                        html += `<input type='number' id='a${i}' value='${s.amount}' min='1' max='500' style='width:70px'> –æ–±. `;
                        html += `<label><input type='checkbox' id='e${i}' ${s.enabled ? 'checked' : ''}> –í–∫–ª—é—á–µ–Ω–æ</label>`;
                        html += `</div>`;
                    }
                    document.getElementById('sch').innerHTML = html;
                })
                .catch(() => {
                    document.getElementById('sch').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        function save() {
            let schedules = [];
            for (let i = 0; i < 5; i++) {
                let time = document.getElementById('t' + i).value.split(':');
                schedules.push({
                    hour: parseInt(time[0]),
                    minute: parseInt(time[1]),
                    amount: parseInt(document.getElementById('a' + i).value),
                    enabled: document.getElementById('e' + i).checked
                });
            }
            
            fetch('/api/schedules', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({schedules: schedules})
            })
                .then(() => alert('‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!'))
                .catch(() => alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function updateTime() {
            fetch('/api/time')
                .then(r => r.json())
                .then(d => {
                    document.getElementById('time').textContent = d.time;
                })
                .catch(() => {
                    document.getElementById('time').textContent = '‚ùå –Ω–µ—Ç —Å–≤—è–∑–∏';
                });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setInterval(updateTime, 5000);  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        updateTime();
        load();
    </script>
</body>
</html>
